import{Q as ee}from"./QSpinnerDots-CS0bZHc0.js";import{r as g,B as K,a9 as te,h as x,o as M,g as d,m as Z,d as n,w as i,Q as u,e as c,t as h,j as J,c as q,J as ae,aj as re,u as oe,a as ne,L as G,M as H,ae as le,f as s,l as ie}from"./index-CdXKqIwE.js";import{b as se,Q as j,a as ue}from"./QSpace-CikJXZ9p.js";import{u as X,Q as k}from"./use-quasar-BVv1AXdb.js";import{_ as W,a as de,b as U,Q as ce}from"./_plugin-vue_export-helper-BlM1Smyy.js";import{u as me}from"./session-store-D5-E9gTF.js";import{M as fe,T as ve}from"./ThreadPanel-EO4UZi4g.js";import"./axios-CpKrHKbl.js";const pe={class:"creator-video-player"},ke={class:"controls-container q-mt-md"},ye={class:"row q-gutter-sm"},ge={key:0,class:"q-mt-sm"},be={__name:"CreatorVideoPlayer",props:{videoId:{type:String,required:!0}},emits:["currentTimeUpdate","createMarker","durationUpdate"],setup(O,{expose:S,emit:w}){const o=O,T=w,v=X(),m=g(null),a=g(null),_=g(0),b=g(null),y=g(1),p=g(600);let P=null;K(()=>{C()}),te(()=>{P&&clearInterval(P),a.value&&a.value.destroy()});function C(){if(window.YT&&window.YT.Player){E();return}if(!window.YT&&!document.querySelector('script[src*="youtube.com/iframe_api"]')){const e=document.createElement("script");e.src="https://www.youtube.com/iframe_api";const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}window.onYouTubeIframeAPIReady||(window.onYouTubeIframeAPIReady=()=>{window.ytCallbacks&&(window.ytCallbacks.forEach(e=>e()),window.ytCallbacks=[])},window.ytCallbacks=[]),window.ytCallbacks=window.ytCallbacks||[],window.ytCallbacks.push(E)}function E(){if(console.log("Initializing YouTube player with video ID:",o.videoId),!o.videoId||o.videoId.length!==11){console.error("Invalid video ID:",o.videoId),v.notify({type:"negative",message:"Invalid video ID format. Please check the YouTube URL.",icon:"error"});return}a.value=new window.YT.Player("creator-youtube-player",{videoId:o.videoId,width:"100%",height:p.value,playerVars:{modestbranding:1,rel:0,origin:window.location.origin,enablejsapi:1},events:{onReady:L,onStateChange:B,onError:N}})}function N(e){console.error("YouTube Player Error:",e.data);let t="Video playback error";e.data===100?t="Video not found or is private":e.data===101||e.data===150?t="This video cannot be embedded. Please try a different video.":e.data===2?t="Invalid video parameter":e.data===5&&(t="HTML5 player error. Try refreshing the page."),v.notify({type:"negative",message:t,caption:`Error code: ${e.data}`,icon:"error",timeout:5e3})}function L(){if(a.value&&a.value.getDuration){const t=a.value.getDuration();T("durationUpdate",t)}const e=Y();e>0&&a.value.seekTo(e,!0),P=setInterval(()=>{a.value&&a.value.getCurrentTime&&(_.value=a.value.getCurrentTime(),T("currentTimeUpdate",_.value),A(_.value))},250)}function B(e){if(e.data===window.YT.PlayerState.ENDED){const t=a.value.getDuration();a.value.seekTo(t-.1,!0),a.value.pauseVideo()}}function Q(e){const t=Math.floor(e/60),f=Math.floor(e%60);return`${t}:${f.toString().padStart(2,"0")}`}function R(){return`video-position-${o.videoId}`}function A(e){try{localStorage.setItem(R(),e.toString())}catch(t){console.warn("Failed to save video position:",t)}}function Y(){try{const e=localStorage.getItem(R());return e?parseFloat(e):0}catch(e){return console.warn("Failed to retrieve video position:",e),0}}function F(){if(!a.value)return;const e=a.value.getCurrentTime();T("createMarker",e,null),v.notify({type:"positive",message:`Point marker created at ${Q(e)}`,icon:"place"})}function I(e){a.value&&(a.value.setPlaybackRate(e),y.value=e,v.notify({type:"info",message:`Playback speed set to ${e}x`,icon:"speed",timeout:1e3}))}function $(e){if(!a.value)return;p.value=e,a.value.setSize("100%",e);const t=e===400?"Small":e===600?"Medium":"Large";v.notify({type:"info",message:`Video size set to ${t}`,icon:"aspect_ratio",timeout:1e3})}function D(e){if(!a.value)return;const t=a.value.getCurrentTime(),f=Math.max(0,t-e);a.value.seekTo(f,!0),v.notify({type:"info",message:`Rewound ${e}s`,icon:"replay",timeout:800})}function V(e){a.value&&a.value.seekTo&&a.value.seekTo(e,!0)}function z(){a.value&&a.value.playVideo&&a.value.playVideo()}function r(){a.value&&a.value.pauseVideo&&a.value.pauseVideo()}function l(){a.value&&(a.value.getPlayerState()===1?r():z())}return S({seekToTime:V,play:z,pause:r,togglePlayPause:l,getCurrentTime:()=>_.value}),(e,t)=>(M(),x("div",pe,[d("div",{id:"creator-youtube-player",ref_key:"playerEl",ref:m},null,512),d("div",ke,[d("div",ye,[n(u,{color:"primary",icon:"place",class:"mark-btn",onClick:F,disable:!a.value},{default:i(()=>[...t[9]||(t[9]=[d("span",{class:"mobile-label"},"Mark",-1),d("span",{class:"desktop-label"},"Mark Current Time",-1)])]),_:1},8,["disable"]),n(se),n(j,{flat:"",class:"seek-controls"},{default:i(()=>[n(u,{icon:"replay_5",onClick:t[0]||(t[0]=f=>D(5)),disable:!a.value,class:"seek-btn"},{default:i(()=>[n(k,null,{default:i(()=>[...t[10]||(t[10]=[c("Rewind 5s",-1)])]),_:1})]),_:1},8,["disable"]),n(u,{icon:"replay_10",onClick:t[1]||(t[1]=f=>D(10)),disable:!a.value,class:"seek-btn"},{default:i(()=>[n(k,null,{default:i(()=>[...t[11]||(t[11]=[c("Rewind 10s",-1)])]),_:1})]),_:1},8,["disable"]),n(u,{icon:"replay_30",onClick:t[2]||(t[2]=f=>D(30)),disable:!a.value,class:"seek-btn"},{default:i(()=>[n(k,null,{default:i(()=>[...t[12]||(t[12]=[c("Rewind 30s",-1)])]),_:1})]),_:1},8,["disable"])]),_:1}),n(j,{outline:""},{default:i(()=>[n(u,{outline:y.value!==1,color:y.value===1?"primary":"grey-7",label:"1x",onClick:t[3]||(t[3]=f=>I(1)),disable:!a.value,size:"sm"},null,8,["outline","color","disable"]),n(u,{outline:y.value!==.85,color:y.value===.85?"primary":"grey-7",label:"0.85x",onClick:t[4]||(t[4]=f=>I(.85)),disable:!a.value,size:"sm"},null,8,["outline","color","disable"]),n(u,{outline:y.value!==.7,color:y.value===.7?"primary":"grey-7",label:"0.7x",onClick:t[5]||(t[5]=f=>I(.7)),disable:!a.value,size:"sm"},null,8,["outline","color","disable"])]),_:1}),n(j,{outline:""},{default:i(()=>[n(u,{outline:p.value!==400,color:p.value===400?"primary":"grey-7",label:"S",onClick:t[6]||(t[6]=f=>$(400)),disable:!a.value,size:"sm"},{default:i(()=>[n(k,null,{default:i(()=>[...t[13]||(t[13]=[c("Small (400px)",-1)])]),_:1})]),_:1},8,["outline","color","disable"]),n(u,{outline:p.value!==600,color:p.value===600?"primary":"grey-7",label:"M",onClick:t[7]||(t[7]=f=>$(600)),disable:!a.value,size:"sm"},{default:i(()=>[n(k,null,{default:i(()=>[...t[14]||(t[14]=[c("Medium (600px)",-1)])]),_:1})]),_:1},8,["outline","color","disable"]),n(u,{outline:p.value!==800,color:p.value===800?"primary":"grey-7",label:"L",onClick:t[8]||(t[8]=f=>$(800)),disable:!a.value,size:"sm"},{default:i(()=>[n(k,null,{default:i(()=>[...t[15]||(t[15]=[c("Large (800px)",-1)])]),_:1})]),_:1},8,["outline","color","disable"])]),_:1})]),b.value?(M(),x("div",ge,[n(de,{class:"bg-secondary text-white",dense:"",rounded:""},{avatar:i(()=>[n(J,{name:"schedule"})]),default:i(()=>[c(" Range started at "+h(Q(b.value)),1)]),_:1})])):Z("",!0)])]))}},we=W(be,[["__scopeId","data-v-9ffd6ffb"]]),Te={key:0,class:"row justify-center q-pa-xl"},_e={key:1,class:"row justify-center"},Me={class:"text-h6"},Se={key:2,class:"session-container"},Ce={class:"header-row"},he=["src"],xe={class:"title-section"},Pe={class:"text-h6"},Ie={class:"text-caption text-grey-7"},$e={class:"header-buttons"},De={class:"vertical-layout"},Ee={class:"row items-center q-gutter-sm q-mb-md"},Qe={key:0,class:"row items-center justify-between q-my-md"},Re={class:"text-h6 text-grey-8"},Ve={__name:"CreatorSessionPage",setup(O){const S=oe(),w=X(),o=me(),T=g(!0),v=g(null),m=g(null),a=g(null),_=q(()=>o.session?`${window.location.origin}/#/helper/${o.session.id}?token=${o.session.helper_token}`:""),b=q(()=>!o.selectedMarker||!o.markers.length?-1:o.markers.findIndex(r=>r.id===o.selectedMarker.id)),y=q(()=>b.value>0),p=q(()=>b.value>=0&&b.value<o.markers.length-1);ae(()=>o.selectedMarker,r=>{r&&m.value&&m.value.seekToTime(r.start_time)}),K(()=>{P(),window.addEventListener("keydown",V)}),re(()=>{o.clearSession(),window.removeEventListener("keydown",V)});async function P(){T.value=!0,v.value=null;try{const r=S.query.token;if(!r){v.value="Token is required";return}a.value=r;const l=await U.getSession(S.params.id,r);if(l.role!=="creator"){v.value="This URL is for creators only";return}o.setSession(l)}catch(r){v.value=r.response?.data?.error||r.message||"Failed to load session"}finally{T.value=!1}}async function C(){try{const r=await U.getSession(S.params.id,a.value);o.updateSession(r)}catch{w.notify({type:"negative",message:"Failed to refresh session",icon:"error"})}}async function E(r,l){try{const e=await U.createMarker(S.params.id,a.value,r,l);if(await C(),e&&e.id){const t=o.markers.find(f=>f.id===e.id);t&&o.setSelectedMarker(t)}}catch(e){throw new Error(e.response?.data?.error||"Failed to create marker")}}function N(){o.selectedMarker&&w.dialog({title:"Delete Marker",message:"Are you sure you want to delete this marker? This will also delete all posts on this marker.",cancel:!0,persistent:!0}).onOk(()=>{L(o.selectedMarker.id)})}async function L(r){try{await U.deleteMarker(r,a.value),w.notify({type:"positive",message:"Marker deleted",icon:"delete"}),o.setSelectedMarker(null),await C()}catch(l){w.notify({type:"negative",message:l.response?.data?.error||"Failed to delete marker",icon:"error"})}}function B(r){o.setSelectedMarker(r)}function Q(){if(y.value){const r=o.markers[b.value-1];o.setSelectedMarker(r)}}function R(){if(p.value){const r=o.markers[b.value+1];o.setSelectedMarker(r)}}function A(r){m.value&&m.value.seekToTime(r)}function Y(r){if(m.value){const l=o.currentTime,e=Math.max(0,l+r);m.value.seekToTime(e)}}function F(r){m.value&&(m.value.seekToTime(r),m.value.play())}function I(r){if(!r)return"";const l=[/[?&]v=([a-zA-Z0-9_-]{11})/,/youtu\.be\/([a-zA-Z0-9_-]{11})/,/embed\/([a-zA-Z0-9_-]{11})/,/\/v\/([a-zA-Z0-9_-]{11})/];for(const e of l){const t=r.match(e);if(t&&t[1])return console.log("Extracted video ID:",t[1],"from URL:",r),t[1]}return console.error("Failed to extract video ID from URL:",r),""}function $(){navigator.clipboard.writeText(_.value),w.notify({type:"positive",message:"Helper link copied to clipboard!",icon:"content_copy",timeout:1500})}function D(){window.open(_.value,"_blank")}function V(r){if(r.code==="Space"||r.key===" "){const l=r.target;if(l.tagName==="INPUT"||l.tagName==="TEXTAREA"||l.isContentEditable||l.tagName==="BUTTON"||l.closest("button"))return;r.preventDefault(),m.value&&m.value.togglePlayPause()}}function z(r){const l=Math.floor(r/60),e=Math.floor(r%60);return`${l}:${e.toString().padStart(2,"0")}`}return(r,l)=>(M(),ne(ce,{class:"q-pa-md"},{default:i(()=>[T.value?(M(),x("div",Te,[n(ee,{color:"primary",size:"50px"})])):v.value?(M(),x("div",_e,[n(G,{style:{"max-width":"500px",width:"100%"}},{default:i(()=>[n(H,{class:"bg-negative text-white"},{default:i(()=>[d("div",Me,[n(J,{name:"error"}),l[2]||(l[2]=c(" Error Loading Session",-1))])]),_:1}),n(H,null,{default:i(()=>[c(h(v.value),1)]),_:1}),n(le,{align:"right"},{default:i(()=>[n(u,{flat:"",label:"Go Home",to:"/",color:"primary"})]),_:1})]),_:1})])):s(o).session?(M(),x("div",Se,[n(G,{class:"q-mb-md"},{default:i(()=>[n(H,{class:"session-header"},{default:i(()=>[d("div",Ce,[n(ie,{size:"64px",rounded:""},{default:i(()=>[d("img",{src:s(o).session.youtube_thumbnail,alt:"Video thumbnail"},null,8,he)]),_:1}),d("div",xe,[d("div",Pe,h(s(o).session.youtube_title),1),d("div",Ie,[n(ue,{dense:"",color:"primary","text-color":"white",icon:"manage_accounts"},{default:i(()=>[...l[3]||(l[3]=[c(" Creator Mode ",-1)])]),_:1})])]),d("div",$e,[n(u,{flat:"",round:"",dense:"",icon:"content_copy",onClick:$,color:"secondary"},{default:i(()=>[n(k,null,{default:i(()=>[...l[4]||(l[4]=[c("Copy helper link",-1)])]),_:1})]),_:1}),n(u,{flat:"",round:"",dense:"",icon:"open_in_new",onClick:D,color:"secondary"},{default:i(()=>[n(k,null,{default:i(()=>[...l[5]||(l[5]=[c("Open helper page",-1)])]),_:1})]),_:1})])])]),_:1})]),_:1}),d("div",De,[n(we,{ref_key:"videoPlayerRef",ref:m,"video-id":I(s(o).session.youtube_url),onCurrentTimeUpdate:l[0]||(l[0]=e=>s(o).setCurrentTime(e)),onDurationUpdate:l[1]||(l[1]=e=>s(o).setVideoDuration(e)),onCreateMarker:E,class:"q-mb-md"},null,8,["video-id"]),d("div",Ee,[n(u,{round:"",icon:"chevron_left",onClick:Q,disable:!y.value,color:"primary"},{default:i(()=>[n(k,null,{default:i(()=>[...l[6]||(l[6]=[c("Previous marker",-1)])]),_:1})]),_:1},8,["disable"]),n(fe,{markers:s(o).markers,"current-time":s(o).currentTime,duration:s(o).videoDuration,"selected-marker":s(o).selectedMarker,onMarkerClick:B,onSeek:A,class:"col"},null,8,["markers","current-time","duration","selected-marker"]),n(u,{round:"",icon:"chevron_right",onClick:R,disable:!p.value,color:"primary"},{default:i(()=>[n(k,null,{default:i(()=>[...l[7]||(l[7]=[c("Next marker",-1)])]),_:1})]),_:1},8,["disable"])]),s(o).selectedMarker?(M(),x("div",Qe,[d("div",Re," Current Mark ("+h(b.value+1)+"/"+h(s(o).markers.length)+"): "+h(z(s(o).selectedMarker.start_time))+"s ",1),n(u,{round:"",color:"negative",icon:"delete_outline",onClick:N,size:"md"},{default:i(()=>[n(k,null,{default:i(()=>[...l[8]||(l[8]=[c("Delete marker",-1)])]),_:1})]),_:1})])):Z("",!0),n(ve,{marker:s(o).selectedMarker,markers:s(o).markers,role:"creator",token:a.value,onPostCreated:C,onMarkerSelected:s(o).setSelectedMarker,onSeek:Y,onPlayFromMarker:F,onMarkerUpdated:C},null,8,["marker","markers","token","onMarkerSelected"])])])):Z("",!0)]),_:1}))}},Fe=W(Ve,[["__scopeId","data-v-2fef3f08"]]);export{Fe as default};
